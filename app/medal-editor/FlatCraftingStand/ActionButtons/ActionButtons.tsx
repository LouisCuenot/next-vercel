import React, { useEffect, useRef, useState } from 'react'
import './ActionButtons.scss'
import { useMedalContext } from '../../context/MedalEditorContext'
import gsap from 'gsap'
import { CollierType, ContoursType, IconType, MetalType } from '@/app/types/Medal'

const ActionButtons = () => {

  const {medalRef, setCurrentMedal, currentMedal, isDarkMode} = useMedalContext()

  const [isAnimating, setIsAnimating] = useState(false)


  const flipMedal = () => {
    if(!medalRef)return
    if(!medalRef.current)return
    if(isAnimating) return
    let rotationTarget = 0
    if(medalRef.current.rotation.z%(Math.PI*2)<1.6){
      rotationTarget = Math.PI
    }
    setIsAnimating(true)
    const tweenRot = gsap.to(medalRef.current.rotation, {
      z: rotationTarget,
      duration: 0.8,
      ease: 'power1.inOut',
      delay:0.1,
      onComplete:()=>setIsAnimating(false)
    })
    const tweenTransIn = gsap.to(medalRef.current.position,{
      z:1,
      duration:0.3,
      ease:'power2.in'
    })
    const tweenTranOut = gsap.to(medalRef.current.position,{
      z:0.2,
      duration:0.3,
      ease:'power2.out',
      delay:0.7
    })
    tweenTransIn.play()
    tweenTranOut.play()
    tweenRot.play()
  }

  const metalOptions:MetalType[] = ['gold','silver','bronce']
  const contourOptions:ContoursType[] = ['stars','points','lauriers','tripleLines','verticalLines']
  const collierOptions:CollierType[] = ['green','blue','pink','cyan','grey','red','yellow','purple','white','black']
  const iconOptions:IconType[] = ['sport','trash','cuisine','menage','chrono','course','toilette']

  const randomize = () => {
    if(!currentMedal)return

    const metal = metalOptions[Math.floor(Math.random()*(metalOptions.length-0.0001))]
    const contours = contourOptions[Math.floor(Math.random()*(contourOptions.length-0.0001))]
    const collier = collierOptions[Math.floor(Math.random()*(collierOptions.length-0.0001))]
    const icon = iconOptions[Math.floor(Math.random()*(iconOptions.length-0.0001))]
    
    setCurrentMedal({
      collier,
      contours,
      icon,
      metal,
      content:currentMedal.content
    })
  }



  return (
    <div
      className='actionButtons'
    >
      <div 
        className={`actionButton ${isAnimating && 'actionActive'} ${isDarkMode ? 'dark' : 'light'}`}
        onClick={flipMedal}
      >
        <span>Retourner</span>
        <svg xmlns="http://www.w3.org/2000/svg" width="11" height="13" viewBox="0 0 11 13" fill="none">
          <path d="M2.08051 11.0383H9.02364L8.27147 11.8119C8.16251 11.9248 8.10131 12.078 8.10131 12.2377C8.10131 12.3974 8.16251 12.5506 8.27147 12.6635C8.38042 12.7764 8.52819 12.8398 8.68227 12.8398C8.83635 12.8398 8.98412 12.7764 9.09307 12.6635L10.8289 10.8644C10.8831 10.8086 10.9261 10.7423 10.9555 10.6692C10.9849 10.5961 11 10.5177 11 10.4386C11 10.3594 10.9849 10.281 10.9555 10.2079C10.9261 10.1349 10.8831 10.0685 10.8289 10.0128L9.09307 8.21368C9.03928 8.15747 8.97529 8.11285 8.90478 8.08241C8.83428 8.05196 8.75865 8.03629 8.68227 8.03629C8.60589 8.03629 8.53026 8.05196 8.45975 8.08241C8.38925 8.11285 8.32525 8.15747 8.27147 8.21368C8.21724 8.26943 8.17419 8.33575 8.14482 8.40883C8.11544 8.48191 8.10032 8.5603 8.10032 8.63947C8.10032 8.71863 8.11544 8.79702 8.14482 8.8701C8.17419 8.94318 8.21724 9.00951 8.27147 9.06526L9.02364 9.83887H2.08051C1.96197 9.84126 1.84414 9.81942 1.73375 9.77459C1.62336 9.72977 1.52257 9.66284 1.43714 9.57763C1.35171 9.49243 1.28331 9.39061 1.23585 9.278C1.18839 9.16539 1.1628 9.04419 1.16054 8.92133V7.44006C1.16054 7.28101 1.09958 7.12847 0.991077 7.01601C0.882569 6.90354 0.735402 6.84036 0.581949 6.84036C0.428496 6.84036 0.281329 6.90354 0.172821 7.01601C0.0643137 7.12847 0.00335489 7.28101 0.00335489 7.44006V8.92133C0.00562477 9.2017 0.0611535 9.47885 0.166771 9.73698C0.272388 9.9951 0.426024 10.2291 0.618908 10.4257C0.811791 10.6223 1.04014 10.7776 1.29093 10.8827C1.54171 10.9878 1.81001 11.0407 2.08051 11.0383ZM1.90693 5.46703C2.01588 5.57996 2.16365 5.6434 2.31773 5.6434C2.47181 5.6434 2.61958 5.57996 2.72853 5.46703C2.83749 5.35411 2.89869 5.20095 2.89869 5.04125C2.89869 4.88154 2.83749 4.72838 2.72853 4.61546L1.97636 3.84184H8.91949C9.03803 3.83945 9.15586 3.8613 9.26625 3.90612C9.37664 3.95094 9.47743 4.01787 9.56286 4.10308C9.64829 4.18828 9.71669 4.2901 9.76415 4.40271C9.81161 4.51532 9.8372 4.63652 9.83946 4.75938V6.24065C9.83946 6.3997 9.90042 6.55224 10.0089 6.66471C10.1174 6.77717 10.2646 6.84036 10.4181 6.84036C10.5715 6.84036 10.7187 6.77717 10.8272 6.66471C10.9357 6.55224 10.9966 6.3997 10.9966 6.24065V4.75938C10.9944 4.47902 10.9388 4.20186 10.8332 3.94373C10.7276 3.68561 10.574 3.45158 10.3811 3.255C10.1882 3.05842 9.95986 2.90314 9.70907 2.79804C9.45829 2.69293 9.18999 2.64006 8.91949 2.64243H1.97636L2.72853 1.86881C2.78276 1.81306 2.82581 1.74674 2.85518 1.67366C2.88456 1.60058 2.89968 1.52219 2.89968 1.44302C2.89968 1.36386 2.88456 1.28547 2.85518 1.21239C2.82581 1.13931 2.78276 1.07299 2.72853 1.01724C2.67475 0.961026 2.61075 0.916411 2.54025 0.885965C2.46974 0.855519 2.39411 0.839844 2.31773 0.839844C2.24135 0.839844 2.16572 0.855519 2.09522 0.885965C2.02471 0.916411 1.96072 0.961026 1.90693 1.01724L0.171147 2.81635C0.116916 2.8721 0.0738724 2.93842 0.0444979 3.0115C0.0151234 3.08458 0 3.16297 0 3.24214C0 3.3213 0.0151234 3.39969 0.0444979 3.47277C0.0738724 3.54585 0.116916 3.61217 0.171147 3.66792L1.90693 5.46703Z" fill={isDarkMode ? '#FFFFFF' : '#8C8C8C'} />
        </svg>
      </div>
      <div 
        className={`actionButton ${isDarkMode ? 'dark' : 'light'}`}
        onClick={randomize}
      >
        <span>Al√©atoire</span>
        <svg xmlns="http://www.w3.org/2000/svg" width="15" height="16" viewBox="0 0 15 16" fill="none">
          <path d="M7.32189 0C7.08358 0 6.84524 0.0532332 6.66064 0.1597L0.766477 3.55831C0.397207 3.77125 0.397207 4.10795 0.766477 4.32089L6.66064 7.7195C7.02991 7.93243 7.61384 7.93243 7.98307 7.7195L13.8772 4.32089C14.2465 4.10799 14.2465 3.77125 13.8772 3.55835L7.98307 0.159738C7.79843 0.0531947 7.56016 0 7.32189 0ZM7.2901 2.04278C7.63789 2.04653 7.95057 2.12592 8.22813 2.28095C8.41797 2.38701 8.5423 2.50801 8.6011 2.64397C8.65795 2.77887 8.6613 2.95663 8.61114 3.17726L8.5494 3.39673C8.5085 3.55379 8.50001 3.66674 8.52393 3.73559C8.5459 3.80341 8.60046 3.86167 8.68761 3.91037L8.81842 3.98337L7.53601 4.69956L7.39351 4.62005C7.23464 4.53136 7.13324 4.4311 7.08933 4.31927C7.04349 4.20639 7.05113 4.02683 7.11225 3.78059L7.17106 3.55951C7.20527 3.42783 7.20862 3.31991 7.18109 3.23572C7.15588 3.15018 7.09872 3.08252 7.00961 3.03275C6.87397 2.95701 6.71152 2.92979 6.52227 2.95109C6.33106 2.97135 6.13363 3.03834 5.92997 3.15207C5.73815 3.2592 5.56387 3.39331 5.40713 3.55439C5.24849 3.71447 5.11232 3.89766 4.99862 4.10395L4.08605 3.59424C4.29125 3.38885 4.49288 3.20918 4.69093 3.05525C4.88901 2.9014 5.09817 2.76293 5.31842 2.63985C5.89629 2.31712 6.43366 2.12522 6.93055 2.06417C7.0498 2.04894 7.16995 2.04179 7.29017 2.04275L7.2901 2.04278ZM9.24862 4.22365L10.2833 4.80152L9.0009 5.51771L7.96617 4.93988L9.24862 4.22365ZM0.372897 4.96468C0.150911 4.95872 0 5.13146 0 5.43701V11.5025C0 11.9276 0.292098 12.4319 0.661368 12.6445L6.33084 15.908C6.70011 16.1206 6.99221 15.9525 6.99221 15.5274V9.46181C6.99221 9.03672 6.70011 8.53254 6.33084 8.31991L0.661368 5.05642C0.557571 4.99661 0.459755 4.96692 0.372897 4.96461V4.96468ZM14.2938 4.96476C14.207 4.96707 14.1092 4.99669 14.0054 5.0565L8.33571 8.31999C7.96644 8.53258 7.67434 9.03687 7.67434 9.46196V15.5276C7.67434 15.9526 7.96644 16.1206 8.33571 15.908L14.0054 12.6446C14.3747 12.4321 14.6667 11.9278 14.6667 11.5027V5.43709C14.6667 5.13162 14.5158 4.95892 14.2938 4.96484V4.96476ZM1.88656 7.41687C2.13943 7.46944 2.37035 7.53371 2.57934 7.60969C2.78883 7.68593 2.99127 7.7802 3.18437 7.89143C3.69422 8.18491 4.08289 8.51931 4.35037 8.89463C4.61785 9.26772 4.75159 9.66569 4.75159 10.0885C4.75159 10.3055 4.71084 10.4768 4.62934 10.6026C4.54783 10.7261 4.40886 10.8299 4.21246 10.9139L4.01181 10.9877C3.86971 11.0432 3.77672 11.1004 3.73283 11.1593C3.68897 11.2159 3.66704 11.294 3.66704 11.3936V11.543L2.5355 10.8917V10.729C2.53548 10.5475 2.56995 10.4068 2.63891 10.3071C2.70788 10.2051 2.85312 10.1094 3.07463 10.0199L3.27528 9.94272C3.39438 9.89618 3.4811 9.83762 3.53543 9.76706C3.59179 9.69772 3.61998 9.61212 3.62001 9.51027C3.62001 9.35537 3.56984 9.20588 3.46952 9.06179C3.36922 8.9155 3.22922 8.79063 3.04951 8.68716C2.88024 8.58977 2.69738 8.52218 2.50093 8.48438C2.3045 8.44438 2.09971 8.43611 1.88656 8.45957V7.41687ZM12.2871 7.74793C12.3458 7.74793 12.4002 7.75425 12.4504 7.76689C12.7179 7.8321 12.8516 8.07613 12.8516 8.499C12.8516 8.71593 12.8109 8.93419 12.7294 9.15376C12.6479 9.3711 12.5089 9.63481 12.3125 9.94487L12.1118 10.2497C11.9697 10.4687 11.8767 10.6329 11.8329 10.7423C11.789 10.8494 11.7671 10.9528 11.7671 11.0524V11.2018L10.6355 11.8531V11.6904C10.6355 11.5088 10.67 11.3285 10.7389 11.1493C10.808 10.9679 10.9532 10.7051 11.1747 10.3607L11.3753 10.0526C11.4944 9.86887 11.5811 9.71048 11.6354 9.57739C11.6918 9.44308 11.72 9.325 11.72 9.22315C11.72 9.06822 11.6699 8.97644 11.5696 8.94783C11.4693 8.91703 11.3293 8.95331 11.1495 9.05668C10.9803 9.15414 10.7974 9.29703 10.601 9.48535C10.4046 9.67149 10.1998 9.89893 9.98666 10.1677V9.12495C10.2395 8.88648 10.4704 8.68496 10.6793 8.52038C10.8883 8.35584 11.09 8.21767 11.2843 8.10587C11.6986 7.86739 12.0329 7.74807 12.2872 7.74789L12.2871 7.74793ZM2.53546 11.3833L3.66704 12.0345V13.2167L2.5355 12.5655V11.3833L2.53546 11.3833ZM11.7671 11.6933V12.8755L10.6355 13.5266V12.3446L11.7671 11.6933Z" fill={isDarkMode ? '#FFFFFF' : '#8C8C8C'} />
        </svg>
      </div>
    </div>
  )
}

export default ActionButtons