import React, { useState } from 'react'
import './DesktopActionButtons.scss'
import { useMedalContext } from '@/app/medal-editor/context/MedalEditorContext'
import gsap from 'gsap'

const DesktopFlipButton = () => {

  const {isDarkMode, medalRef} = useMedalContext()

  const [isAnimating, setIsAnimating] = useState(false)


  const flipMedal = () => {
    if(!medalRef)return
    if(!medalRef.current)return
    if(isAnimating) return
    let rotationTarget = 0
    if(medalRef.current.rotation.z%(Math.PI*2)>-1.6){
      rotationTarget = -Math.PI
    }
    setIsAnimating(true)
    const tweenRot = gsap.to(medalRef.current.rotation, {
      z: rotationTarget,
      duration: 0.8,
      ease: 'power1.inOut',
      delay:0.1,
      onComplete:()=>setIsAnimating(false)
    })
    const tweenTransIn = gsap.to(medalRef.current.position,{
      z:1,
      duration:0.3,
      ease:'power2.in'
    })
    const tweenTranOut = gsap.to(medalRef.current.position,{
      z:0.2,
      duration:0.3,
      ease:'power2.out',
      delay:0.7
    })
    tweenTransIn.play()
    tweenTranOut.play()
    tweenRot.play()
  }

  return (
    <div
      className={`actionButton ${isDarkMode?'dark':'light'}`}
      onClick={flipMedal}
    >
      <span>Retourner</span>
      <svg xmlns="http://www.w3.org/2000/svg" width="11" height="13" viewBox="0 0 11 13" fill="none">
          <path d="M2.08051 11.0383H9.02364L8.27147 11.8119C8.16251 11.9248 8.10131 12.078 8.10131 12.2377C8.10131 12.3974 8.16251 12.5506 8.27147 12.6635C8.38042 12.7764 8.52819 12.8398 8.68227 12.8398C8.83635 12.8398 8.98412 12.7764 9.09307 12.6635L10.8289 10.8644C10.8831 10.8086 10.9261 10.7423 10.9555 10.6692C10.9849 10.5961 11 10.5177 11 10.4386C11 10.3594 10.9849 10.281 10.9555 10.2079C10.9261 10.1349 10.8831 10.0685 10.8289 10.0128L9.09307 8.21368C9.03928 8.15747 8.97529 8.11285 8.90478 8.08241C8.83428 8.05196 8.75865 8.03629 8.68227 8.03629C8.60589 8.03629 8.53026 8.05196 8.45975 8.08241C8.38925 8.11285 8.32525 8.15747 8.27147 8.21368C8.21724 8.26943 8.17419 8.33575 8.14482 8.40883C8.11544 8.48191 8.10032 8.5603 8.10032 8.63947C8.10032 8.71863 8.11544 8.79702 8.14482 8.8701C8.17419 8.94318 8.21724 9.00951 8.27147 9.06526L9.02364 9.83887H2.08051C1.96197 9.84126 1.84414 9.81942 1.73375 9.77459C1.62336 9.72977 1.52257 9.66284 1.43714 9.57763C1.35171 9.49243 1.28331 9.39061 1.23585 9.278C1.18839 9.16539 1.1628 9.04419 1.16054 8.92133V7.44006C1.16054 7.28101 1.09958 7.12847 0.991077 7.01601C0.882569 6.90354 0.735402 6.84036 0.581949 6.84036C0.428496 6.84036 0.281329 6.90354 0.172821 7.01601C0.0643137 7.12847 0.00335489 7.28101 0.00335489 7.44006V8.92133C0.00562477 9.2017 0.0611535 9.47885 0.166771 9.73698C0.272388 9.9951 0.426024 10.2291 0.618908 10.4257C0.811791 10.6223 1.04014 10.7776 1.29093 10.8827C1.54171 10.9878 1.81001 11.0407 2.08051 11.0383ZM1.90693 5.46703C2.01588 5.57996 2.16365 5.6434 2.31773 5.6434C2.47181 5.6434 2.61958 5.57996 2.72853 5.46703C2.83749 5.35411 2.89869 5.20095 2.89869 5.04125C2.89869 4.88154 2.83749 4.72838 2.72853 4.61546L1.97636 3.84184H8.91949C9.03803 3.83945 9.15586 3.8613 9.26625 3.90612C9.37664 3.95094 9.47743 4.01787 9.56286 4.10308C9.64829 4.18828 9.71669 4.2901 9.76415 4.40271C9.81161 4.51532 9.8372 4.63652 9.83946 4.75938V6.24065C9.83946 6.3997 9.90042 6.55224 10.0089 6.66471C10.1174 6.77717 10.2646 6.84036 10.4181 6.84036C10.5715 6.84036 10.7187 6.77717 10.8272 6.66471C10.9357 6.55224 10.9966 6.3997 10.9966 6.24065V4.75938C10.9944 4.47902 10.9388 4.20186 10.8332 3.94373C10.7276 3.68561 10.574 3.45158 10.3811 3.255C10.1882 3.05842 9.95986 2.90314 9.70907 2.79804C9.45829 2.69293 9.18999 2.64006 8.91949 2.64243H1.97636L2.72853 1.86881C2.78276 1.81306 2.82581 1.74674 2.85518 1.67366C2.88456 1.60058 2.89968 1.52219 2.89968 1.44302C2.89968 1.36386 2.88456 1.28547 2.85518 1.21239C2.82581 1.13931 2.78276 1.07299 2.72853 1.01724C2.67475 0.961026 2.61075 0.916411 2.54025 0.885965C2.46974 0.855519 2.39411 0.839844 2.31773 0.839844C2.24135 0.839844 2.16572 0.855519 2.09522 0.885965C2.02471 0.916411 1.96072 0.961026 1.90693 1.01724L0.171147 2.81635C0.116916 2.8721 0.0738724 2.93842 0.0444979 3.0115C0.0151234 3.08458 0 3.16297 0 3.24214C0 3.3213 0.0151234 3.39969 0.0444979 3.47277C0.0738724 3.54585 0.116916 3.61217 0.171147 3.66792L1.90693 5.46703Z" fill={isDarkMode ? '#FFFFFF' : '#8C8C8C'} />
        </svg>
    </div>
  )
}

export default DesktopFlipButton